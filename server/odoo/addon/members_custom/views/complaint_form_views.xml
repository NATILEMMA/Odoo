<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <!-- This record will display types of complaints -->
  <record id="complaint_form_tree" model="ir.ui.view">
    <field name="name">complaint.form.tree</field>
    <field name="model">member.complaint</field>
    <field name="arch" type="xml">
      <tree delete="false" decoration-danger="state == 'rejected'" decoration-success="state == 'resolved'" decoration-info="state == 'waiting for approval' or state == 'transferred' or state == 'transferred to city'">
        <field name="name"/>
        <field name="create_date"/>
        <field name="wereda_handler"/>
        <field name="date_of_remedy"/>
        <field name="state"/>
      </tree>
    </field>
  </record>


  <!-- This record will create kan ban view for complaint -->
  <record id="complaint_kanban_view" model="ir.ui.view">
    <field name="name">complaint.kanban.view</field>
    <field name="model">member.complaint</field>
    <field name="arch" type="xml">
        <kanban class="o_res_partner_kanban" sample="1">
          <field name="id"/>
          <field name="name"/>
          <field name="create_date"/>
          <field name="wereda_handler"/>
          <field name="subcity_handler"/>
          <field name="state"/>
          <field name="date_of_remedy"/>
          <field name="date_of_remedy_subcity"/>
          <field name="transfer_1"/>
          <field name="transfer_2"/>
          <templates>
              <t t-name="kanban-box">
                  <div class="oe_kanban_global_click o_kanban_record_has_image_fill o_partner_kanban">
                      <div class="oe_kanban_details d-flex flex-column justify-content-between">
                          <div class="o_kanban_record_top">
                              <div class="o_kanban_record_headings">
                                  <strong class="o_kanban_record_title">
                                    <ul>
                                      <li t-if="record.name.raw_value or record.create_date.raw_value">
                                        <t t-if="record.name.raw_value"><field name="name"/><t t-if="record.create_date.raw_value"> of <field name="create_date"/></t></t>
                                      </li>
                                    </ul>
                                  </strong>
                              </div>
                          </div>
                          <div>
                              <div class="o_kanban_tags_section oe_kanban_partner_categories"/>
                              <t t-if="record.transfer_1.raw_value and !record.transfer_2.raw_value">
                                <ul>
                                    <li t-if="record.wereda_handler.raw_value or record.date_of_remedy.raw_value">
                                        <t t-if="record.wereda_handler.raw_value">Handled by: <field name="wereda_handler"/> until <t t-if="record.date_of_remedy.raw_value"><field name="date_of_remedy"/></t></t>
                                    </li>
                                </ul>
                              </t>
                              <t t-if="record.transfer_2.raw_value and !record.transfer_1.raw_value">
                                <ul>
                                    <li t-if="record.subcity_handler.raw_value or record.date_of_remedy_subcity.raw_value">
                                        <t t-if="record.subcity_handler.raw_value">Handled by: <field name="subcity_handler"/> until <t t-if="record.date_of_remedy_subcity.raw_value"><field name="date_of_remedy_subcity"/></t></t>
                                    </li>
                                </ul>
                              </t>
                          </div>
                          <div>
                              <div class="o_kanban_tags_section oe_kanban_partner_categories"/>
                              <ul>
                                  <li t-if="record.state.raw_value" class="o_text_overflow"><field name="state"/></li>
                              </ul>
                          </div>
                          <div class="o_kanban_record_bottom">
                              <div class="oe_kanban_bottom_left"/>
                              <div class="oe_kanban_bottom_right"/>
                          </div>
                      </div>
                  </div>
              </t>
          </templates>
        </kanban>
    </field>
  </record>

  <!-- This record will create the form view of complaints -->
  <record id="view_complaint_form" model="ir.ui.view">
    <field name="name">view.complaint.form</field>
    <field name="model">member.complaint</field>
    <field name="arch" type="xml">
      <form>
          <header>
            <button type="object" name="waiting_for_approval" string="Waiting For Approval" class="oe_highlight" states="draft" groups="members_custom.member_group_complaint_management"/>
            <button type="object" name="send_review_to_member" string="Send Review" class="oe_highlight" icon="fa-envelope-o" attrs="{'invisible': [('state', 'not in', ('resolved', 'rejected'))]}" groups="members_custom.member_group_complaint_management"/>
            <button type="object" name="send_pending_to_member" string="Send Pending" icon="fa-envelope" states="waiting for approval" groups="members_custom.member_group_complaint_management"/>
            <button type="object" name="transfer_button" string="Transfer to Subcity" class="oe_highlight" attrs="{'invisible': ['|', '|', ('transfer_1', '=', True), ('transfer_2', '=', True), ('state', 'not in', ('resolved', 'rejected'))]}" groups="members_custom.member_group_complaint_management"/>
            <button type="object" name="transfer_city_button" string="Transfer to City" class="oe_highlight" attrs="{'invisible': ['|', ('transfer_1', '=', False), ('state', 'not in', ('resolved', 'rejected'))]}" groups="members_custom.member_group_complaint_management"/>
            <field name="state" widget="statusbar" statusbar_visible="draft,waiting for approval,transferred,transferred to city,resolved,rejected"/>
          </header>
          <sheet>
            <h1>
                <field name="name"/>
            </h1>
            <group>
              <field name="wereda_id" force_save="1" invisible="1"/>
              <field name="subcity_id" force_save="1" invisible="1"/>
              <field name="city_id" force_save="1" invisible="1"/>
              <field name="transfer_1" invisible="1"/>
              <field name="transfer_2" invisible="1"/>
              <field name="transfer_3" invisible="1"/>
              <field name="x_css" invisible="1"/>
              <group>
                <field name="subject" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
              </group>
              <group>
                <field name="victim_id" string="Victims" required="1" force_save="1" attrs="{'readonly': [('state', '!=', 'draft')]}" context="{'form_view_ref': 'members_custom.membership_view_partner_form'}" options="{'no_create': True, 'no_create_edit': True}"/>
              </group>
            </group>
            <group>
              <field name="circumstances" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
            </group>
            <notebook>
              <page string="Woreda Report">
                <group>
                  <group>
                    <field name="wereda_handler" force_save="1"/>
                  </group>
                  <group>
                      <label for="duration_of_remedy" string="Duration of Remedy"/>
                      <div><field name="duration_of_remedy" string="Duration of Remedy" force_save="1" class="oe_inline"/> days</div>
                      <field name="date_of_remedy" string="Date of Remedy" force_save="1" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                  </group>
                </group>
                <group>
                  <group>
                    <field name="conclusion_report_wereda" attrs="{'readonly': ['|', '|', '|', ('state', '=', 'resolved'), ('state', '=', 'rejected'), ('state', '=', 'transferred'), ('state', '=', 'transferred to city')]}"/>
                  </group>
                </group>
                <group>
                  <group>
                    <button name="complaint_resolved" string="Resolved" type="object" class="oe_highlight" icon="fa-check" attrs="{'invisible': ['|', '|', '|', ('state', '=', 'resolved'), ('state', '=', 'rejected'), ('state', '=', 'transferred'), ('state', '=', 'transferred to city')]}"/>
                  </group>
                  <group>
                    <button name="complaint_rejected" string="Rejected" type="object" icon="fa-times" attrs="{'invisible': ['|', '|', '|', ('state', '=', 'resolved'), ('state', '=', 'rejected'), ('state', '=', 'transferred'), ('state', '=', 'transferred to city')]}"/>
                  </group>
                </group>
              </page>
              <page string="Subcity Report" attrs="{'invisible': ['&amp;', ('transfer_2', '=', False), ('transfer_1', '=', False)]}">
                <group>
                  <group>
                    <field name="subcity_handler" force_save="1"/>
                  </group>
                  <group>
                      <label for="duration_of_remedy_subcity" string="Duration of Remedy"/>
                      <div><field name="duration_of_remedy_subcity" string="Duration of Remedy" force_save="1" class="oe_inline"/> days</div>
                      <field name="date_of_remedy_subcity" string="Date of Remedy" force_save="1" attrs="{'readonly': ['|', '|', ('state', '=', 'resolved'), ('state', '=', 'rejected'), ('state', '=', 'transferred to city')]}"/>
                  </group>
                </group>
                <group>
                  <group>
                    <field name="conclusion_report_subcity" attrs="{'readonly': ['|', '|', ('state', '=', 'resolved'), ('state', '=', 'rejected'), ('state', '=', 'transferred to city')]}"/>
                  </group>
                </group>
                <group>
                  <group>
                    <button name="complaint_resolved" string="Resolved" type="object" class="oe_highlight" icon="fa-check" attrs="{'invisible': ['|', '|', ('state', '=', 'resolved'), ('state', '=', 'rejected'), ('state', '=', 'transferred to city')]}"/>
                  </group>
                  <group>
                    <button name="complaint_rejected" string="Rejected" type="object" icon="fa-times" attrs="{'invisible': ['|', '|', ('state', '=', 'resolved'), ('state', '=', 'rejected'), ('state', '=', 'transferred to city')]}"/>
                  </group>
                </group>
              </page>
              <page string="City Report" attrs="{'invisible': [('transfer_2', '=', False)]}">
                <group>
                  <group>
                    <field name="city_handler" force_save="1"/>
                  </group>
                  <group>
                      <label for="duration_of_remedy_city" string="Duration of Remedy"/>
                      <div><field name="duration_of_remedy_city" string="Duration of Remedy" force_save="1" class="oe_inline"/> days</div>
                      <field name="date_of_remedy_city" string="Date of Remedy" force_save="1"/>
                  </group>
                </group>
                <group>
                  <group>
                    <field name="conclusion_report_city" attrs="{'readonly': ['|', ('state', '=', 'resolved'), ('state', '=', 'rejected')]}"/>
                  </group>
                </group>
                <group>
                  <group>
                    <button name="complaint_resolved" string="Resolved" type="object" class="oe_highlight" icon="fa-check" attrs="{'invisible': ['|', ('state', '=', 'resolved'), ('state', '=', 'rejected')]}"/>
                  </group>
                  <group>
                    <button name="complaint_rejected" string="Rejected" type="object" icon="fa-times" attrs="{'invisible': ['|', ('state', '=', 'resolved'), ('state', '=', 'rejected')]}"/>
                  </group>
                </group>
              </page>
            </notebook>
          </sheet>
          <div class="oe_chatter">
            <field name="message_follower_ids" widget="mail_followers"/>
            <field name="activity_ids" widget="mail_activity"/>
            <field name="message_ids" widget="mail_thread"/>
          </div>
      </form>
    </field>
  </record>

  <!-- This record will display graphs of complaints -->
  <record id="status_graph" model="ir.ui.view">
    <field name="name">status.graph</field>
    <field name="model">member.complaint</field>
    <field name="arch" type="xml">
      <graph>
        <field name="state"/>
      </graph>
    </field>
  </record>


  <!-- This record will handle the search options for complaint -->
  <record id="complaint_view_search" model="ir.ui.view">
    <field name="name">complaint.view.search</field>
    <field name="model">member.complaint</field>
    <field name="arch" type="xml">
      <search string="Complaint">
          <field name="victim_id" string="Victims" filter_domain="[('victim_id', 'ilike', self)]"/>
          <separator/>
            <filter name="state" string="Status" domain="[('state', 'in', ['draft', 'waiting for approval'])]"/>
          <separator/>
            <filter name="duration_of_remedy" string="Duration of Remedy" domain="[('duration_of_remedy', '&lt;', 31)]"/>
      </search>
    </field>
  </record>


  <!-- This record will create an action to complaints -->
  <record id="complaint_form_action" model="ir.actions.act_window">
    <field name="name">Complaints</field>
    <field name="res_model">member.complaint</field>
    <field name="view_mode">tree,form,graph,pivot</field>
    <field name="limit">20</field>
    <field name="context">{'search_default_state': 1}</field>
    <field name="domain">['|', '|', ('wereda_handler', '=', uid), ('subcity_handler', '=', uid), ('city_handler', '=', uid)]</field>
  </record>


  <menuitem id="complaint_form_menu"
            name="Complaint"
            parent="membership.menu_association"
            action="complaint_form_action"
            sequence="80"
            groups="members_custom.member_group_complaint_management"/>

  <!-- <menuitem id="complaint_list_view"
            name="List of Complaints"
            parent="complaint_form_menu"
            sequence="1"
            action="complaint_form_action"/> -->

</odoo>
